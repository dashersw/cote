{"version":3,"sources":["../../src/components/discovery.js"],"names":["Discover","require","colors","_","Discovery","advertisement","options","defaults","helloInterval","checkInterval","nodeTimeout","masterTimeout","monitor","log","helloLogsEnabled","statusLogsEnabled","ignoreProcess","type","advertise","me","id","broadcast","instanceUuid","processId","processUuid","processCommand","process","argv","slice","map","n","split","join","helloLogger","on","obj","key","statusLogger","logs","console","apply","concat","white","status","statusLog","green","red","push","name","magenta","grey","port","toString","blue","module","exports"],"mappings":"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","file":"discovery.js","sourcesContent":["const Discover = require('@dashersw/node-discover');\nconst colors = require('colors');\nconst _ = require('lodash');\n\nclass Discovery extends Discover {\n    constructor(advertisement, options = {}) {\n        _.defaults(options, Discovery.defaults, {\n            helloInterval: 2000,\n            checkInterval: 4000,\n            nodeTimeout: 5000,\n            masterTimeout: 6000,\n            monitor: false,\n            log: true,\n            helloLogsEnabled: true,\n            statusLogsEnabled: true,\n            ignoreProcess: false,\n        });\n\n        super(options);\n\n        this.advertisement = _.defaults(advertisement, {\n            type: 'service',\n        });\n\n        this.advertise(advertisement);\n\n        this.me.id = this.broadcast.instanceUuid;\n        this.me.processId = this.broadcast.processUuid;\n        this.me.processCommand = process.argv.slice(1).map((n) => {\n            return n.split('/').slice(-2).join('/');\n        }).join(' ');\n\n        options.log && this.log(this.helloLogger());\n\n        this.on('added', (obj) => {\n            if (!options.monitor && obj.advertisement.key != this.advertisement.key) return;\n\n            options.log && options.statusLogsEnabled && options.helloLogsEnabled &&\n                this.log(this.statusLogger(obj, 'online'));\n        });\n\n        this.on('removed', (obj) => {\n            if (!options.monitor && obj.advertisement.key != this.advertisement.key) return;\n\n            options.log && options.statusLogsEnabled &&\n                this.log(this.statusLogger(obj, 'offline'));\n        });\n    }\n\n    static setDefaults(options) {\n        this.defaults = options;\n    }\n\n    log(logs) {\n        console.log.apply(console.log, logs);\n    }\n\n    helloLogger() {\n        return _.concat('\\nHello! I\\'m'.white, this.statusLogger(this.me),\n            '\\n========================\\n'.white);\n    }\n\n    statusLogger(obj, status) {\n        const logs = [];\n\n        if (status) {\n            const statusLog = status == 'online' ? '.online'.green : '.offline'.red;\n            logs.push(this.advertisement.name, '>', obj.advertisement.type.magenta + statusLog);\n        } else {\n            logs.push();\n        }\n\n        logs.push(\n            `${obj.advertisement.name.white}${'#'.grey}${obj.id.grey}`);\n\n        if (obj.advertisement.port) {\n            logs.push('on', obj.advertisement.port.toString().blue);\n        }\n\n        return logs;\n    }\n\n}\n\nmodule.exports = Discovery;\n"]}